Project Path: Nexus

Source Tree:

```txt
Nexus
├── backend
│   ├── main.py
│   ├── models.py
│   ├── routers
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   │   ├── __init__.cpython-313.pyc
│   │   │   ├── auth.cpython-313.pyc
│   │   │   └── subscription.cpython-313.pyc
│   │   ├── auth.py
│   │   └── subscription.py
│   └── schemas.py
└── src
    ├── components
    │   ├── Shell.jsx
    │   └── Workspace.jsx
    ├── context
    │   └── StudioContext.jsx
    └── panels
        ├── BasePanelInterface.js
        ├── ChatPanel
        │   └── index.jsx
        ├── WorkspacePanel
        │   └── index.jsx
        └── registry.js

```

`Nexus/backend/main.py`:

```py
   1 | from fastapi import FastAPI
   2 | from fastapi.middleware.cors import CORSMiddleware
   3 | from database import engine, Base
   4 | from routers import auth, subscription
   5 | import logging
   6 | 
   7 | logging.basicConfig(level=logging.INFO)
   8 | 
   9 | Base.metadata.create_all(bind=engine)
  10 | 
  11 | app = FastAPI(title="Nexus Backend")
  12 | 
  13 | app.add_middleware(
  14 |     CORSMiddleware,
  15 |     allow_origins=["http://localhost:5173", "http://127.0.0.1:5173"], 
  16 |     allow_credentials=True,
  17 |     allow_methods=["*"],
  18 |     allow_headers=["*"],
  19 | )
  20 | 
  21 | app.include_router(auth.router)
  22 | app.include_router(subscription.router)
  23 | 
  24 | @app.get("/")
  25 | def read_root():
  26 |     return {"message": "Welcome to Nexus API"}

```

`Nexus/backend/models.py`:

```py
   1 | from sqlalchemy import Column, Integer, String, Boolean, ForeignKey, DateTime
   2 | from sqlalchemy.orm import relationship
   3 | from datetime import datetime
   4 | from database import Base
   5 | 
   6 | class User(Base):
   7 |     __tablename__ = "users"
   8 | 
   9 |     id = Column(Integer, primary_key=True, index=True)
  10 |     email = Column(String, unique=True, index=True)
  11 |     hashed_password = Column(String)
  12 |     full_name = Column(String, nullable=True)
  13 |     is_active = Column(Boolean, default=True)
  14 |     created_at = Column(DateTime, default=datetime.utcnow)
  15 | 
  16 |     subscription = relationship("Subscription", back_populates="user", uselist=False)
  17 | 
  18 | class Subscription(Base):
  19 |     __tablename__ = "subscriptions"
  20 | 
  21 |     id = Column(Integer, primary_key=True, index=True)
  22 |     user_id = Column(Integer, ForeignKey("users.id"))
  23 |     plan_name = Column(String, default="free") # free, pro, enterprise
  24 |     is_active = Column(Boolean, default=True)
  25 |     start_date = Column(DateTime, default=datetime.utcnow)
  26 |     end_date = Column(DateTime, nullable=True)
  27 | 
  28 |     user = relationship("User", back_populates="subscription")

```

`Nexus/backend/routers/auth.py`:

```py
   1 | from fastapi import APIRouter, Depends, HTTPException, status
   2 | from sqlalchemy.orm import Session
   3 | from fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm
   4 | import models, schemas, utils, database
   5 | from datetime import timedelta
   6 | from jose import JWTError, jwt
   7 | import logging
   8 | 
   9 | logger = logging.getLogger(__name__)
  10 | 
  11 | router = APIRouter(
  12 |     prefix="/auth",
  13 |     tags=["auth"]
  14 | )
  15 | 
  16 | oauth2_scheme = OAuth2PasswordBearer(tokenUrl="auth/token")
  17 | 
  18 | def get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(database.get_db)):
  19 |     credentials_exception = HTTPException(
  20 |         status_code=status.HTTP_401_UNAUTHORIZED,
  21 |         detail="Could not validate credentials",
  22 |         headers={"WWW-Authenticate": "Bearer"},
  23 |     )
  24 |     try:
  25 |         payload = jwt.decode(token, utils.SECRET_KEY, algorithms=[utils.ALGORITHM])
  26 |         email: str = payload.get("sub")
  27 |         if email is None:
  28 |             raise credentials_exception
  29 |         token_data = schemas.TokenData(email=email)
  30 |     except JWTError:
  31 |         raise credentials_exception
  32 |     user = db.query(models.User).filter(models.User.email == token_data.email).first()
  33 |     if user is None:
  34 |         raise credentials_exception
  35 |     return user
  36 | 
  37 | @router.post("/signup", response_model=schemas.User)
  38 | def signup(user: schemas.UserCreate, db: Session = Depends(database.get_db)):
  39 |     db_user = db.query(models.User).filter(models.User.email == user.email).first()
  40 |     if db_user:
  41 |         raise HTTPException(status_code=400, detail="Email already registered")
  42 |     
  43 |     hashed_password = utils.get_password_hash(user.password)
  44 |     new_user = models.User(
  45 |         email=user.email,
  46 |         hashed_password=hashed_password,
  47 |         full_name=user.full_name
  48 |     )
  49 |     db.add(new_user)
  50 |     db.commit()
  51 |     db.refresh(new_user)
  52 |     
  53 |     # Create default free subscription
  54 |     new_sub = models.Subscription(user_id=new_user.id, plan_name="free")
  55 |     db.add(new_sub)
  56 |     db.commit()
  57 |     db.refresh(new_user)
  58 |     
  59 |     return new_user
  60 | 
  61 | @router.post("/token", response_model=schemas.Token)
  62 | def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends(), db: Session = Depends(database.get_db)):
  63 |     logger.info(f"Login attempt for email: {form_data.username}")
  64 |     user = db.query(models.User).filter(models.User.email == form_data.username).first()
  65 |     
  66 |     if not user:
  67 |         logger.warning(f"User not found for email: {form_data.username}")
  68 |         raise HTTPException(
  69 |             status_code=status.HTTP_401_UNAUTHORIZED,
  70 |             detail="Incorrect username or password",
  71 |             headers={"WWW-Authenticate": "Bearer"},
  72 |         )
  73 |     
  74 |     logger.info(f"User found: {user.email}, checking password...")
  75 |     password_valid = utils.verify_password(form_data.password, user.hashed_password)
  76 |     logger.info(f"Password verification result: {password_valid}")
  77 |     
  78 |     if not password_valid:
  79 |         logger.warning(f"Invalid password for user: {user.email}")
  80 |         raise HTTPException(
  81 |             status_code=status.HTTP_401_UNAUTHORIZED,
  82 |             detail="Incorrect username or password",
  83 |             headers={"WWW-Authenticate": "Bearer"},
  84 |         )
  85 |     
  86 |     access_token_expires = timedelta(minutes=utils.ACCESS_TOKEN_EXPIRE_MINUTES)
  87 |     access_token = utils.create_access_token(
  88 |         data={"sub": user.email}, expires_delta=access_token_expires
  89 |     )
  90 |     logger.info(f"Login successful for user: {user.email}")
  91 |     return {"access_token": access_token, "token_type": "bearer"}
  92 | 
  93 | @router.get("/me", response_model=schemas.User)
  94 | def read_users_me(current_user: models.User = Depends(get_current_user)):
  95 |     return current_user

```

`Nexus/backend/routers/subscription.py`:

```py
   1 | from fastapi import APIRouter, Depends, HTTPException
   2 | from sqlalchemy.orm import Session
   3 | import models, schemas, database
   4 | from routers.auth import get_current_user
   5 | 
   6 | router = APIRouter(
   7 |     prefix="/subscription",
   8 |     tags=["subscription"]
   9 | )
  10 | 
  11 | @router.get("/", response_model=schemas.Subscription)
  12 | def get_subscription(current_user: models.User = Depends(get_current_user)):
  13 |     if not current_user.subscription:
  14 |         raise HTTPException(status_code=404, detail="Subscription not found")
  15 |     return current_user.subscription
  16 | 
  17 | @router.post("/upgrade")
  18 | def upgrade_subscription(plan: str, current_user: models.User = Depends(get_current_user), db: Session = Depends(database.get_db)):
  19 |     # In a real app, this would integrate with Stripe/LemonSqueezy
  20 |     if plan not in ["pro", "enterprise"]:
  21 |         raise HTTPException(status_code=400, detail="Invalid plan")
  22 |     
  23 |     sub = current_user.subscription
  24 |     sub.plan_name = plan
  25 |     db.commit()
  26 |     return {"message": f"Upgraded to {plan}"}

```

`Nexus/backend/schemas.py`:

```py
   1 | from pydantic import BaseModel, EmailStr
   2 | from typing import Optional
   3 | from datetime import datetime
   4 | 
   5 | class SubscriptionBase(BaseModel):
   6 |     plan_name: str
   7 |     is_active: bool
   8 |     start_date: datetime
   9 |     end_date: Optional[datetime] = None
  10 | 
  11 | class Subscription(SubscriptionBase):
  12 |     id: int
  13 |     user_id: int
  14 | 
  15 |     class Config:
  16 |         from_attributes = True
  17 | 
  18 | class UserBase(BaseModel):
  19 |     email: EmailStr
  20 |     full_name: Optional[str] = None
  21 | 
  22 | class UserCreate(UserBase):
  23 |     password: str
  24 | 
  25 | class UserLogin(BaseModel):
  26 |     email: EmailStr
  27 |     password: str
  28 | 
  29 | class User(UserBase):
  30 |     id: int
  31 |     is_active: bool
  32 |     created_at: datetime
  33 |     subscription: Optional[Subscription] = None
  34 | 
  35 |     class Config:
  36 |         from_attributes = True
  37 | 
  38 | class Token(BaseModel):
  39 |     access_token: str
  40 |     token_type: str
  41 | 
  42 | class TokenData(BaseModel):
  43 |     email: Optional[str] = None

```

`Nexus/src/components/Shell.jsx`:

```jsx
   1 | import React, { useEffect } from 'react';
   2 | import useStudioStore, { useKeyboardShortcuts } from '../context/StudioContext';
   3 | import Sidebar from './Sidebar';
   4 | import Workspace from './Workspace';
   5 | import CommandPalette from './CommandPalette';
   6 | import AddPanelModal from './AddPanelModal';
   7 | import SettingsModal from './SettingsModal';
   8 | import HelpModal from './HelpModal';
   9 | 
  10 | import Background from './Background';
  11 | 
  12 | /**
  13 |  * Shell - The main container/commander for the entire IDE
  14 |  * 
  15 |  * Responsibilities:
  16 |  * - Layout management
  17 |  * - Keyboard shortcuts
  18 |  * - Global modals (command palette, add panel)
  19 |  * - Cross-panel coordination
  20 |  * */
  21 | export default function Shell() {
  22 |   // Initialize keyboard shortcuts
  23 |   useKeyboardShortcuts();
  24 | 
  25 |   const { commandPaletteOpen, addPanelModalOpen, settingsModalOpen, helpModalOpen } = useStudioStore();
  26 | 
  27 |   return (
  28 |     <div className="flex h-screen w-full bg-primary text-text-primary overflow-hidden relative">
  29 |       <Background />
  30 | 
  31 |       {/* Main layout */}
  32 |       <div className="relative flex w-full z-10">
  33 |         {/* Left Sidebar (The Dock) */}
  34 |         <Sidebar />
  35 | 
  36 |         {/* Main Workspace */}
  37 |         <Workspace />
  38 |       </div>
  39 | 
  40 |       {/* Command Palette Modal */}
  41 |       {commandPaletteOpen && <CommandPalette />}
  42 | 
  43 |       {/* Add Panel Modal */}
  44 |       {addPanelModalOpen && <AddPanelModal />}
  45 | 
  46 |       {/* Settings Modal */}
  47 |       {settingsModalOpen && <SettingsModal />}
  48 | 
  49 |       {/* Help Modal */}
  50 |       {helpModalOpen && <HelpModal />}
  51 | 
  52 |       {/* Keyboard shortcut hints */}
  53 |       <div className="fixed bottom-4 right-4 flex items-center gap-3 text-xs text-zinc-600 pointer-events-none z-50">
  54 |         <span className="flex items-center gap-1.5">
  55 |           <kbd className="px-1.5 py-0.5 rounded bg-zinc-800/80 text-zinc-500 font-mono">⌘K</kbd>
  56 |           Command
  57 |         </span>
  58 |         <span className="flex items-center gap-1.5">
  59 |           <kbd className="px-1.5 py-0.5 rounded bg-zinc-800/80 text-zinc-500 font-mono">⌘N</kbd>
  60 |           New Panel
  61 |         </span>
  62 |       </div>
  63 |     </div>
  64 |   );
  65 | }

```

`Nexus/src/components/Workspace.jsx`:

```jsx
   1 | import React from 'react';
   2 | import { Layout, Plus } from 'lucide-react';
   3 | import useStudioStore from '../context/StudioContext';
   4 | import PanelContainer from './PanelContainer';
   5 | 
   6 | /**
   7 |  * Workspace - The main area where panels are displayed
   8 |  * 
   9 |  * Handles:
  10 |  * - Panel layout (flexible, fullscreen, minimized)
  11 |  * - Empty state
  12 |  * - Panel transitions
  13 |  */
  14 | export default function Workspace() {
  15 |   const {
  16 |     panels,
  17 |     activeFullscreenId,
  18 |     focusedPanelId,
  19 |     openAddPanelModal
  20 |   } = useStudioStore();
  21 | 
  22 |   // Get visible panels (not hidden)
  23 |   const visiblePanels = panels.filter(p => p.mode !== 'hidden');
  24 | 
  25 |   // Check if we have any panels at all
  26 |   const hasNoPanels = panels.length === 0;
  27 |   const hasNoVisiblePanels = visiblePanels.length === 0;
  28 | 
  29 |   return (
  30 |     <div className="flex-1 flex flex-col overflow-hidden">
  31 |       {/* Workspace Header */}
  32 |       <div className="h-12 flex items-center justify-between px-6 border-b border-white/5 bg-black/20 backdrop-blur-sm flex-shrink-0">
  33 |         <div className="flex items-center gap-3">
  34 |           <h1 className="text-sm font-semibold text-zinc-300">Workspace</h1>
  35 |           <span className="text-xs text-zinc-600">
  36 |             {visiblePanels.length} panel{visiblePanels.length !== 1 ? 's' : ''} active
  37 |           </span>
  38 |         </div>
  39 | 
  40 |         <div className="flex items-center gap-2">
  41 |           {/* Quick add button */}
  42 |           <button
  43 |             onClick={openAddPanelModal}
  44 |             className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium text-zinc-400 hover:text-white hover:bg-white/10 transition-colors"
  45 |           >
  46 |             <Plus size={14} />
  47 |             Add Panel
  48 |           </button>
  49 |         </div>
  50 |       </div>
  51 | 
  52 |       {/* Main workspace area */}
  53 |       <div className="flex-1 overflow-hidden p-4">
  54 |         {hasNoPanels || hasNoVisiblePanels ? (
  55 |           /* Empty State */
  56 |           <div className="h-full flex flex-col items-center justify-center">
  57 |             <div className="relative">
  58 |               {/* Decorative background */}
  59 |               <div className="absolute inset-0 -m-20 bg-gradient-to-br from-zinc-800/10 to-transparent rounded-full blur-3xl pointer-events-none" />
  60 | 
  61 |               <div className="relative text-center z-10">
  62 |                 <div className="w-20 h-20 mx-auto mb-8 rounded-2xl bg-zinc-900/50 border border-white/5 flex items-center justify-center backdrop-blur-sm">
  63 |                   <Layout size={32} className="text-zinc-500" />
  64 |                 </div>
  65 | 
  66 |                 <h2 className="text-5xl md:text-6xl font-bold tracking-tight mb-6 flex items-center justify-center">
  67 |                   {hasNoPanels ? (
  68 |                     <>
  69 |                       <span className="text-zinc-500">Graph</span>
  70 |                       <span className="text-white">Studio</span>
  71 |                       <span className="animate-blink text-white ml-1">_</span>
  72 |                     </>
  73 |                   ) : (
  74 |                     <span className="text-zinc-300">No Active Panels</span>
  75 |                   )}
  76 |                 </h2>
  77 |                 <p className="text-base text-zinc-500 mb-8 max-w-md mx-auto">
  78 |                   {hasNoPanels
  79 |                     ? 'Get started by adding your first panel. Create flowcharts, Kanban boards, code, and more.'
  80 |                     : 'Click on a panel in the sidebar to show it, or add a new panel to get started.'
  81 |                   }
  82 |                 </p>
  83 | 
  84 |                 <button
  85 |                   onClick={openAddPanelModal}
  86 |                   className="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-white text-black font-semibold text-sm hover:bg-zinc-200 transition-colors shadow-lg shadow-white/5"
  87 |                 >
  88 |                   <Plus size={18} />
  89 |                   Add Your First Panel
  90 |                 </button>
  91 | 
  92 |                 <p className="text-xs text-zinc-600 mt-8">
  93 |                   Press <kbd className="px-1.5 py-0.5 rounded bg-zinc-900 border border-zinc-800 text-zinc-500 font-mono mx-1">⌘N</kbd> for quick add
  94 |                 </p>
  95 |               </div>
  96 |             </div>
  97 |           </div>
  98 |         ) : (
  99 |           /* Panels Grid */
 100 |           <div className="h-full flex gap-4 overflow-hidden">
 101 |             {visiblePanels.map((panel, index) => {
 102 |               // If another panel is fullscreen, hide this one
 103 |               if (activeFullscreenId && activeFullscreenId !== panel.id) {
 104 |                 return null;
 105 |               }
 106 | 
 107 |               // Determine panel width based on mode
 108 |               let widthClass = '';
 109 |               if (panel.mode === 'fullscreen') {
 110 |                 widthClass = 'w-full';
 111 |               } else if (panel.mode === 'minimized') {
 112 |                 widthClass = 'w-16';
 113 |               } else {
 114 |                 // Flexible mode - share space
 115 |                 widthClass = 'flex-1 min-w-[300px] max-w-none';
 116 |               }
 117 | 
 118 |               return (
 119 |                 <div
 120 |                   key={panel.id}
 121 |                   draggable={panel.mode !== 'fullscreen'}
 122 |                   onDragStart={(e) => {
 123 |                     e.dataTransfer.setData('text/plain', panel.id);
 124 |                     e.dataTransfer.effectAllowed = 'move';
 125 |                     // Add a class to styling
 126 |                     e.currentTarget.classList.add('opacity-50');
 127 |                   }}
 128 |                   onDragEnd={(e) => {
 129 |                     e.currentTarget.classList.remove('opacity-50');
 130 |                   }}
 131 |                   onDragOver={(e) => {
 132 |                     e.preventDefault();
 133 |                     e.dataTransfer.dropEffect = 'move';
 134 |                   }}
 135 |                   onDrop={(e) => {
 136 |                     e.preventDefault();
 137 |                     const sourceId = e.dataTransfer.getData('text/plain');
 138 |                     if (sourceId && sourceId !== panel.id) {
 139 |                       const { reorderPanels } = useStudioStore.getState();
 140 |                       reorderPanels(sourceId, panel.id);
 141 |                     }
 142 |                   }}
 143 |                   className={`${widthClass} h-full transition-all duration-300`}
 144 |                 >
 145 |                   <PanelContainer
 146 |                     panel={panel}
 147 |                     widthClass="w-full"
 148 |                     isFocused={focusedPanelId === panel.id}
 149 |                   />
 150 |                 </div>
 151 |               );
 152 |             })}
 153 |           </div>
 154 |         )}
 155 |       </div>
 156 |     </div>
 157 |   );
 158 | }

```

`Nexus/src/context/StudioContext.jsx`:

```jsx
   1 | import React from 'react';
   2 | import { create } from 'zustand';
   3 | import { subscribeWithSelector } from 'zustand/middleware';
   4 | 
   5 | /**
   6 |  * Panel Mode Types:
   7 |  * - 'hidden': Panel is in sidebar only, not visible in workspace
   8 |  * - 'minimized': Panel is a thin vertical bar in workspace
   9 |  * - 'flexible': Panel takes shared space in workspace
  10 |  * - 'fullscreen': Panel takes entire workspace
  11 |  */
  12 | 
  13 | /**
  14 |  * @typedef {'hidden' | 'minimized' | 'flexible' | 'fullscreen'} PanelMode
  15 |  * 
  16 |  * @typedef {Object} PanelInstance
  17 |  * @property {string} id - Unique identifier
  18 |  * @property {string} panelTypeId - Reference to panel type in registry
  19 |  * @property {string} title - Display title
  20 |  * @property {PanelMode} mode - Current display mode
  21 |  * @property {Object} state - Panel-specific state data
  22 |  * @property {number} order - Display order in workspace
  23 |  * @property {boolean} isAIObserving - Whether AI is reading this panel's context
  24 |  */
  25 | 
  26 | const useStudioStore = create(
  27 |   subscribeWithSelector((set, get) => ({
  28 |     // === Panel Instances State ===
  29 |     panels: [
  30 |       {
  31 |         id: 'builtin-chat',
  32 |         panelTypeId: 'chat',
  33 |         title: 'AI Assistant',
  34 |         mode: 'flexible',
  35 |         state: { messages: [] }, // Initial state will be merged/handled by component
  36 |         order: 0,
  37 |         isAIObserving: false,
  38 |       }
  39 |     ],
  40 | 
  41 |     // === UI State ===
  42 |     activeFullscreenId: null,
  43 |     focusedPanelId: null,
  44 |     commandPaletteOpen: false,
  45 |     addPanelModalOpen: false,
  46 |     settingsModalOpen: false,
  47 |     helpModalOpen: false,
  48 | 
  49 |     // === Settings State ===
  50 |     theme: 'dark', // 'dark' | 'light'
  51 |     shortcuts: {
  52 |       commandPalette: 'k',
  53 |       newItem: 'n'
  54 |     },
  55 | 
  56 |     // === Drag & Drop State ===
  57 |     dragSource: null,
  58 |     dragData: null,
  59 |     dropTarget: null,
  60 | 
  61 |     // === AI State ===
  62 |     aiObservingPanels: [],
  63 |     globalContext: {},
  64 | 
  65 |     // === Panel Actions ===
  66 |     addPanel: (panelTypeId, initialState = {}) => {
  67 |       const id = `panel-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  68 |       const panels = get().panels;
  69 | 
  70 |       set({
  71 |         panels: [
  72 |           ...panels,
  73 |           {
  74 |             id,
  75 |             panelTypeId,
  76 |             title: initialState.title || panelTypeId,
  77 |             mode: 'flexible',
  78 |             state: initialState,
  79 |             order: panels.length,
  80 |             isAIObserving: false,
  81 |           }
  82 |         ]
  83 |       });
  84 | 
  85 |       return id;
  86 |     },
  87 | 
  88 |     removePanel: (id) => {
  89 |       const panel = get().panels.find(p => p.id === id);
  90 |       if (panel && panel.panelTypeId === 'chat') {
  91 |         console.warn("Cannot remove built-in Chat Panel");
  92 |         // Optionally flash a toast or alert
  93 |         return;
  94 |       }
  95 | 
  96 |       set((state) => ({
  97 |         panels: state.panels.filter(p => p.id !== id),
  98 |         focusedPanelId: state.focusedPanelId === id ? null : state.focusedPanelId,
  99 |         activeFullscreenId: state.activeFullscreenId === id ? null : state.activeFullscreenId,
 100 |       }));
 101 |     },
 102 | 
 103 |     updatePanelMode: (id, mode) => {
 104 |       set((state) => {
 105 |         let newActiveFullscreen = state.activeFullscreenId;
 106 | 
 107 |         // Handle fullscreen logic
 108 |         if (mode === 'fullscreen') {
 109 |           newActiveFullscreen = id;
 110 |         } else if (state.activeFullscreenId === id) {
 111 |           newActiveFullscreen = null;
 112 |         }
 113 | 
 114 |         return {
 115 |           panels: state.panels.map(p =>
 116 |             p.id === id ? { ...p, mode } : p
 117 |           ),
 118 |           activeFullscreenId: newActiveFullscreen,
 119 |         };
 120 |       });
 121 |     },
 122 | 
 123 |     updatePanelState: (id, newState) => {
 124 |       set((state) => ({
 125 |         panels: state.panels.map(p =>
 126 |           p.id === id ? { ...p, state: { ...p.state, ...newState } } : p
 127 |         )
 128 |       }));
 129 |     },
 130 | 
 131 |     updatePanelTitle: (id, title) => {
 132 |       set((state) => ({
 133 |         panels: state.panels.map(p =>
 134 |           p.id === id ? { ...p, title } : p
 135 |         )
 136 |       }));
 137 |     },
 138 | 
 139 |     reorderPanels: (sourceId, targetId) => {
 140 |       set((state) => {
 141 |         const panels = [...state.panels];
 142 |         const sourceIndex = panels.findIndex(p => p.id === sourceId);
 143 |         const targetIndex = panels.findIndex(p => p.id === targetId);
 144 | 
 145 |         if (sourceIndex === -1 || targetIndex === -1) return state;
 146 | 
 147 |         const [removed] = panels.splice(sourceIndex, 1);
 148 |         panels.splice(targetIndex, 0, removed);
 149 | 
 150 |         return { panels: panels.map((p, i) => ({ ...p, order: i })) };
 151 |       });
 152 |     },
 153 | 
 154 |     // === Focus Actions ===
 155 |     setFocusedPanel: (id) => {
 156 |       set({ focusedPanelId: id });
 157 |     },
 158 | 
 159 |     // === Command Palette Actions ===
 160 |     toggleCommandPalette: () => {
 161 |       set((state) => ({ commandPaletteOpen: !state.commandPaletteOpen }));
 162 |     },
 163 | 
 164 |     openCommandPalette: () => set({ commandPaletteOpen: true }),
 165 |     closeCommandPalette: () => set({ commandPaletteOpen: false }),
 166 | 
 167 |     // === Add Panel Modal Actions ===
 168 |     openAddPanelModal: () => set({ addPanelModalOpen: true }),
 169 |     closeAddPanelModal: () => set({ addPanelModalOpen: false }),
 170 | 
 171 |     // === Settings & Help Actions ===
 172 |     openSettingsModal: () => set({ settingsModalOpen: true }),
 173 |     closeSettingsModal: () => set({ settingsModalOpen: false }),
 174 |     openHelpModal: () => set({ helpModalOpen: true }),
 175 |     closeHelpModal: () => set({ helpModalOpen: false }),
 176 | 
 177 |     setTheme: (theme) => {
 178 |       set({ theme });
 179 |       if (theme === 'dark') {
 180 |         document.documentElement.classList.add('dark');
 181 |       } else {
 182 |         document.documentElement.classList.remove('dark');
 183 |       }
 184 |     },
 185 | 
 186 |     updateShortcuts: (action, key) => set(state => ({
 187 |       shortcuts: { ...state.shortcuts, [action]: key }
 188 |     })),
 189 | 
 190 |     // === Drag & Drop Actions ===
 191 |     startDrag: (sourceId, data) => {
 192 |       set({ dragSource: sourceId, dragData: data });
 193 |     },
 194 | 
 195 |     setDropTarget: (targetId) => {
 196 |       set({ dropTarget: targetId });
 197 |     },
 198 | 
 199 |     endDrag: () => {
 200 |       set({ dragSource: null, dragData: null, dropTarget: null });
 201 |     },
 202 | 
 203 |     // === AI Context Actions ===
 204 |     setAIObserving: (panelId, isObserving) => {
 205 |       set((state) => ({
 206 |         panels: state.panels.map(p =>
 207 |           p.id === panelId ? { ...p, isAIObserving: isObserving } : p
 208 |         ),
 209 |         aiObservingPanels: isObserving
 210 |           ? [...state.aiObservingPanels, panelId]
 211 |           : state.aiObservingPanels.filter(id => id !== panelId)
 212 |       }));
 213 |     },
 214 | 
 215 |     updateGlobalContext: (key, value) => {
 216 |       set((state) => ({
 217 |         globalContext: { ...state.globalContext, [key]: value }
 218 |       }));
 219 |     },
 220 | 
 221 |     // === Selectors ===
 222 |     getVisiblePanels: () => {
 223 |       const state = get();
 224 |       return state.panels.filter(p => p.mode !== 'hidden');
 225 |     },
 226 | 
 227 |     getHiddenPanels: () => {
 228 |       const state = get();
 229 |       return state.panels.filter(p => p.mode === 'hidden');
 230 |     },
 231 | 
 232 |     getPanelById: (id) => {
 233 |       return get().panels.find(p => p.id === id);
 234 |     },
 235 |   }))
 236 | );
 237 | 
 238 | export default useStudioStore;
 239 | 
 240 | // === Keyboard Shortcut Hook ===
 241 | export const useKeyboardShortcuts = () => {
 242 |   const { toggleCommandPalette, openAddPanelModal } = useStudioStore();
 243 | 
 244 |   React.useEffect(() => {
 245 |     const handleKeyDown = (e) => {
 246 |       // Cmd/Ctrl + K: Toggle command palette
 247 |       if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
 248 |         e.preventDefault();
 249 |         toggleCommandPalette();
 250 |       }
 251 | 
 252 |       // Cmd/Ctrl + N: Add new panel
 253 |       if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
 254 |         e.preventDefault();
 255 |         openAddPanelModal();
 256 |       }
 257 | 
 258 |       // Escape: Close modals
 259 |       if (e.key === 'Escape') {
 260 |         useStudioStore.getState().closeCommandPalette();
 261 |         useStudioStore.getState().closeAddPanelModal();
 262 |         useStudioStore.getState().closeSettingsModal();
 263 |         useStudioStore.getState().closeHelpModal();
 264 |       }
 265 |     };
 266 | 
 267 |     window.addEventListener('keydown', handleKeyDown);
 268 |     return () => window.removeEventListener('keydown', handleKeyDown);
 269 |   }, []);
 270 | };

```

`Nexus/src/panels/BasePanelInterface.js`:

```js
   1 | /**
   2 |  * Base Panel Interface - All panels must implement this interface
   3 |  * 
   4 |  * This defines the contract between the Shell (container) and Panel (app)
   5 |  * Each panel type registers with these properties and methods
   6 |  */
   7 | 
   8 | /**
   9 |  * @typedef {Object} PanelData
  10 |  * @property {'dsl/json' | 'image/png' | 'text/plain' | 'code/javascript' | 'code/html'} contentType
  11 |  * @property {any} data - The actual data (DSL, image bytes, text, etc.)
  12 |  * @property {string} schemaVersion - Version of the data schema
  13 |  */
  14 | 
  15 | /**
  16 |  * @typedef {Object} PanelAction
  17 |  * @property {string} id - Unique action identifier
  18 |  * @property {string} label - Display label for command palette
  19 |  * @property {string} [shortcut] - Keyboard shortcut
  20 |  * @property {string} [category] - Action category for grouping
  21 |  * @property {Function} handler - Action handler function
  22 |  */
  23 | 
  24 | /**
  25 |  * @typedef {Object} ExportFormat
  26 |  * @property {string} format - Format identifier (png, svg, json, pdf)
  27 |  * @property {string} label - Display label
  28 |  * @property {string} [mimeType] - MIME type for download
  29 |  */
  30 | 
  31 | /**
  32 |  * @typedef {Object} DropZone
  33 |  * @property {string[]} acceptTypes - Content types this panel accepts
  34 |  * @property {Function} onDrop - Handler for dropped content
  35 |  */
  36 | 
  37 | /**
  38 |  * IStudioPanelDefinition - The interface every panel type must implement
  39 |  * 
  40 |  * @typedef {Object} IStudioPanelDefinition
  41 |  * @property {string} id - Unique panel type identifier
  42 |  * @property {string} name - Display name
  43 |  * @property {string} description - Short description of what the panel does
  44 |  * @property {React.ElementType} icon - Lucide icon component
  45 |  * @property {string} category - Category for grouping (e.g., 'creation', 'data', 'ai')
  46 |  * @property {string} accentColor - Tailwind color class for theming
  47 |  * 
  48 |  * @property {Function} renderMainView - Render the main content area
  49 |  * @property {Function} [renderPropertiesPanel] - Render inspector/properties panel
  50 |  * @property {Function} [renderToolbar] - Render custom toolbar
  51 |  * 
  52 |  * @property {Function} getLLMContext - Get context for AI to understand panel content
  53 |  * @property {Function} applyLLMChange - Apply changes from AI
  54 |  * 
  55 |  * @property {DropZone} [dropZone] - Drop zone configuration
  56 |  * @property {ExportFormat[]} [exportFormats] - Supported export formats
  57 |  * @property {PanelAction[]} [actions] - Actions for command palette
  58 |  * 
  59 |  * @property {Function} [onMount] - Called when panel mounts
  60 |  * @property {Function} [onUnmount] - Called when panel unmounts
  61 |  * @property {Function} [onFocus] - Called when panel gains focus
  62 |  * @property {Function} [onBlur] - Called when panel loses focus
  63 |  */
  64 | 
  65 | /**
  66 |  * MCP (Model Context Protocol) Interface
  67 |  * 
  68 |  * @typedef {Object} MCPTool
  69 |  * @property {string} name - Unique tool name
  70 |  * @property {string} description - Description for the LLM
  71 |  * @property {Object} inputSchema - JSON Schema for arguments
  72 |  */
  73 | 
  74 | /**
  75 |  * @property {Function} getMCPTools - Get tools exposed by this panel
  76 |  * @property {Function} executeMCPTool - Execute a tool on this panel
  77 |  * @property {Function} getMCPContext - Get structured context for LLM
  78 |  */
  79 | 
  80 | /**
  81 |  * Creates a panel definition with defaults
  82 |  * @param {Partial<IStudioPanelDefinition>} definition 
  83 |  * @returns {IStudioPanelDefinition}
  84 |  */
  85 | export function createPanelDefinition(definition) {
  86 |   return {
  87 |     // Required fields (must be provided)
  88 |     id: definition.id,
  89 |     name: definition.name || definition.id,
  90 |     description: definition.description || '',
  91 |     icon: definition.icon,
  92 |     category: definition.category || 'general',
  93 |     accentColor: definition.accentColor || 'violet',
  94 | 
  95 |     // Rendering (main view is required)
  96 |     renderMainView: definition.renderMainView,
  97 |     renderPropertiesPanel: definition.renderPropertiesPanel || null,
  98 |     renderToolbar: definition.renderToolbar || null,
  99 | 
 100 |     // AI Integration
 101 |     getLLMContext: definition.getLLMContext || (async () => ({ type: 'empty', data: null })),
 102 |     applyLLMChange: definition.applyLLMChange || (async () => false),
 103 | 
 104 |     // MCP Integration
 105 |     getMCPTools: definition.getMCPTools || (async () => []),
 106 |     executeMCPTool: definition.executeMCPTool || (async () => { throw new Error('Tool not implemented'); }),
 107 |     getMCPContext: definition.getMCPContext || (async () => ({ type: 'empty', content: null })), // Structured context
 108 | 
 109 |     // Interoperability
 110 |     dropZone: definition.dropZone || null,
 111 |     exportFormats: definition.exportFormats || [],
 112 |     actions: definition.actions || [],
 113 | 
 114 |     // Lifecycle
 115 |     onMount: definition.onMount || (() => { }),
 116 |     onUnmount: definition.onUnmount || (() => { }),
 117 |     onFocus: definition.onFocus || (() => { }),
 118 |     onBlur: definition.onBlur || (() => { }),
 119 | 
 120 |     // Initial state factory
 121 |     getInitialState: definition.getInitialState || (() => ({})),
 122 |   };
 123 | }
 124 | 
 125 | /**
 126 |  * Panel Categories for organization
 127 |  */
 128 | export const PanelCategories = {
 129 |   CREATION: 'creation',    // Canvas, editors for creating things
 130 |   DATA: 'data',            // Notes, sources, data views
 131 |   AI: 'ai',                // Chat, AI assistants
 132 |   UTILITY: 'utility',      // Settings, config, tools
 133 |   PREVIEW: 'preview',      // Previews, output views
 134 | };
 135 | 
 136 | /**
 137 |  * Common content types for drag & drop
 138 |  */
 139 | export const ContentTypes = {
 140 |   TEXT_PLAIN: 'text/plain',
 141 |   TEXT_MARKDOWN: 'text/markdown',
 142 |   TEXT_CODE: 'text/code',
 143 |   DSL_FLOWCHART: 'dsl/flowchart',
 144 |   DSL_KANBAN: 'dsl/kanban',
 145 |   DSL_SVG: 'dsl/svg',
 146 |   IMAGE_PNG: 'image/png',
 147 |   IMAGE_SVG: 'image/svg+xml',
 148 |   JSON: 'application/json',
 149 |   PANEL_REF: 'application/x-panel-ref', // Reference to another panel
 150 | };
 151 | 
 152 | /**
 153 |  * Utility to create a drag data object
 154 |  */
 155 | export function createDragData(contentType, data, sourcePanelId) {
 156 |   return {
 157 |     contentType,
 158 |     data,
 159 |     sourcePanelId,
 160 |     timestamp: Date.now(),
 161 |   };
 162 | }
 163 | 
 164 | /**
 165 |  * Utility to check if a drop target accepts a drag data type
 166 |  */
 167 | export function canAcceptDrop(dropZone, dragData) {
 168 |   if (!dropZone || !dragData) return false;
 169 |   return dropZone.acceptTypes.includes(dragData.contentType);
 170 | }
 171 | 
 172 | export default {
 173 |   createPanelDefinition,
 174 |   PanelCategories,
 175 |   ContentTypes,
 176 |   createDragData,
 177 |   canAcceptDrop,
 178 | };

```

`Nexus/src/panels/ChatPanel/index.jsx`:

```jsx
   1 | 
   2 | import React, { useState, useRef, useEffect } from 'react';
   3 | import { MessageSquare, Send, Sparkles, Loader2, Bot, User, Paperclip, Mic, Terminal, Settings } from 'lucide-react';
   4 | import { createPanelDefinition, PanelCategories, ContentTypes } from '../BasePanelInterface';
   5 | import useStudioStore from '../../context/StudioContext';
   6 | import { getPanelDefinition } from '../registry';
   7 | 
   8 | /**
   9 |  * Chat Panel - The built-in AI Assistant and MCP Orchestrator
  10 |  */
  11 | 
  12 | // --- Components ---
  13 | 
  14 | function MessageBubble({ message }) {
  15 |     const isUser = message.role === 'user';
  16 | 
  17 |     return (
  18 |         <div className={`flex gap-3 ${isUser ? 'flex-row-reverse' : ''}`}>
  19 |             <div className={`
  20 |         flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center
  21 |         ${isUser ? 'bg-violet-500' : 'bg-gradient-to-br from-cyan-500 to-violet-500'}
  22 |       `}>
  23 |                 {isUser ? <User size={14} className="text-white" /> : <Bot size={14} className="text-white" />}
  24 |             </div>
  25 | 
  26 |             <div className={`
  27 |         max-w-[85%] rounded-2xl px-4 py-2.5
  28 |         ${isUser
  29 |                     ? 'bg-violet-500 text-white rounded-br-md shadow-sm'
  30 |                     : 'bg-zinc-800 text-zinc-100 rounded-bl-md border border-white/5 shadow-sm'
  31 |                 }
  32 |       `}>
  33 |                 <p className="text-sm leading-relaxed whitespace-pre-wrap">{message.content}</p>
  34 | 
  35 |                 {/* Tool Call Visualization (Mock) */}
  36 |                 {message.toolCalls && (
  37 |                     <div className="mt-2 space-y-2">
  38 |                         {message.toolCalls.map((call, i) => (
  39 |                             <div key={i} className="text-xs bg-black/20 rounded p-2 font-mono border border-white/5">
  40 |                                 <div className="flex items-center gap-1 text-zinc-400 mb-1">
  41 |                                     <Terminal size={10} />
  42 |                                     <span>Calling: {call.name}</span>
  43 |                                 </div>
  44 |                                 <div className="text-zinc-300 overflow-x-auto">
  45 |                                     {JSON.stringify(call.args)}
  46 |                                 </div>
  47 |                             </div>
  48 |                         ))}
  49 |                     </div>
  50 |                 )}
  51 | 
  52 |                 {message.timestamp && (
  53 |                     <p className={`text-[10px] mt-1.5 ${isUser ? 'text-violet-200' : 'text-zinc-500'}`}>
  54 |                         {new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
  55 |                     </p>
  56 |                 )}
  57 |             </div>
  58 |         </div>
  59 |     );
  60 | }
  61 | 
  62 | function TypingIndicator() {
  63 |     return (
  64 |         <div className="flex gap-3">
  65 |             <div className="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-violet-500 flex items-center justify-center">
  66 |                 <Bot size={14} className="text-white" />
  67 |             </div>
  68 |             <div className="bg-zinc-800 rounded-2xl rounded-bl-md px-4 py-3 border border-white/5">
  69 |                 <div className="flex gap-1">
  70 |                     <span className="w-2 h-2 bg-zinc-500 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
  71 |                     <span className="w-2 h-2 bg-zinc-500 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
  72 |                     <span className="w-2 h-2 bg-zinc-500 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
  73 |                 </div>
  74 |             </div>
  75 |         </div>
  76 |     );
  77 | }
  78 | 
  79 | function MCPStatus({ activePanels }) {
  80 |     const [tools, setTools] = useState([]);
  81 | 
  82 |     useEffect(() => {
  83 |         const fetchTools = async () => {
  84 |             let collectedTools = [];
  85 |             for (const panel of activePanels) {
  86 |                 const def = getPanelDefinition(panel.panelTypeId);
  87 |                 if (def && def.getMCPTools) {
  88 |                     try {
  89 |                         const panelTools = await def.getMCPTools(panel.state);
  90 |                         collectedTools = [...collectedTools, ...panelTools.map(t => ({ ...t, source: panel.title }))];
  91 |                     } catch (e) {
  92 |                         console.error(`Failed to get tools from ${panel.title}:`, e);
  93 |                     }
  94 |                 }
  95 |             }
  96 |             setTools(collectedTools);
  97 |         };
  98 |         fetchTools();
  99 |     }, [activePanels]);
 100 | 
 101 |     return (
 102 |         <div className="flex items-center gap-2 px-4 py-2 border-b border-white/5 bg-zinc-900/50">
 103 |             <div className="flex items-center gap-1.5 text-xs text-zinc-400">
 104 |                 <div className={`w-1.5 h-1.5 rounded-full ${tools.length > 0 ? 'bg-green-500' : 'bg-zinc-600'}`} />
 105 |                 <span>{tools.length} Tools Connected</span>
 106 |             </div>
 107 |             {tools.length > 0 && (
 108 |                 <div className="flex -space-x-1 overflow-hidden ml-auto">
 109 |                     {/* Preview (dots) */}
 110 |                     {tools.slice(0, 3).map((t, i) => (
 111 |                         <div key={i} className="w-4 h-4 rounded-full bg-zinc-800 border border-zinc-900 flex items-center justify-center text-[8px] text-zinc-500" title={`${t.source}: ${t.name}`}>
 112 |                             T
 113 |                         </div>
 114 |                     ))}
 115 |                 </div>
 116 |             )}
 117 |         </div>
 118 |     );
 119 | }
 120 | 
 121 | // --- Main View ---
 122 | 
 123 | function ChatMainView({ panelState, updateState, isFocused }) {
 124 |     const { getVisiblePanels } = useStudioStore();
 125 |     const visiblePanels = getVisiblePanels();
 126 | 
 127 |     const [messages, setMessages] = useState(panelState?.messages || [
 128 |         {
 129 |             id: 'welcome',
 130 |             role: 'assistant',
 131 |             content: 'Hello! I am connected to your workspace. I can read your panels and execute actions.',
 132 |             timestamp: Date.now()
 133 |         }
 134 |     ]);
 135 |     const [input, setInput] = useState('');
 136 |     const [isTyping, setIsTyping] = useState(false);
 137 |     const messagesEndRef = useRef(null);
 138 | 
 139 |     const scrollToBottom = () => {
 140 |         messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
 141 |     };
 142 | 
 143 |     useEffect(() => {
 144 |         scrollToBottom();
 145 |     }, [messages, isTyping]);
 146 | 
 147 |     const handleSend = async () => {
 148 |         if (!input.trim()) return;
 149 | 
 150 |         // Add User Message
 151 |         const userMessage = {
 152 |             id: `msg-${Date.now()}`,
 153 |             role: 'user',
 154 |             content: input.trim(),
 155 |             timestamp: Date.now(),
 156 |         };
 157 | 
 158 |         setMessages(prev => {
 159 |             const updated = [...prev, userMessage];
 160 |             updateState?.({ messages: updated });
 161 |             return updated;
 162 |         });
 163 |         setInput('');
 164 |         setIsTyping(true);
 165 | 
 166 |         // --- MOCK AI RESPONSE WITH TOOLS ---
 167 |         // In a real app, this would call the backend with the collected tools
 168 |         setTimeout(async () => {
 169 |             setIsTyping(false);
 170 | 
 171 |             // Mock: Check if user asked to create something (demonstrating tool usage)
 172 |             const lowerInput = userMessage.content.toLowerCase();
 173 |             let toolCall = null;
 174 |             let responseContent = "I've processed your request.";
 175 | 
 176 |             if (lowerInput.includes('create') && lowerInput.includes('note')) {
 177 |                 toolCall = { name: 'create_note', args: { title: 'New Note', content: 'Generated from chat' } };
 178 |                 responseContent = "I'll create a new note for you.";
 179 |             } else if (lowerInput.includes('tools')) {
 180 |                 responseContent = "I am scanning for tools...";
 181 |             }
 182 | 
 183 |             const aiMessage = {
 184 |                 id: `ai-${Date.now()}`,
 185 |                 role: 'assistant',
 186 |                 content: responseContent,
 187 |                 timestamp: Date.now(),
 188 |                 toolCalls: toolCall ? [toolCall] : undefined
 189 |             };
 190 | 
 191 |             setMessages(prev => {
 192 |                 const updated = [...prev, aiMessage];
 193 |                 updateState?.({ messages: updated });
 194 |                 return updated;
 195 |             });
 196 | 
 197 |             // Mock Tool Execution
 198 |             if (toolCall) {
 199 |                 // In reality: locate target panel, call executeMCPTool
 200 |                 console.log("Mock executing tool:", toolCall);
 201 |                 // We would find the panel that exports 'create_note' and call it
 202 |             }
 203 | 
 204 |         }, 1000);
 205 |     };
 206 | 
 207 |     const handleKeyDown = (e) => {
 208 |         if (e.key === 'Enter' && !e.shiftKey) {
 209 |             e.preventDefault();
 210 |             handleSend();
 211 |         }
 212 |     };
 213 | 
 214 |     return (
 215 |         <div className="flex flex-col h-full bg-zinc-900/50">
 216 |             <MCPStatus activePanels={visiblePanels} />
 217 | 
 218 |             {/* Messages */}
 219 |             <div className="flex-1 overflow-y-auto p-4 space-y-5">
 220 |                 {messages.map(msg => (
 221 |                     <MessageBubble key={msg.id} message={msg} />
 222 |                 ))}
 223 |                 {isTyping && <TypingIndicator />}
 224 |                 <div ref={messagesEndRef} />
 225 |             </div>
 226 | 
 227 |             {/* Input */}
 228 |             <div className="p-4 border-t border-white/5 bg-zinc-900">
 229 |                 <div className={`
 230 |           flex items-end gap-2 p-2 rounded-2xl bg-zinc-800/80 border transition-colors shadow-inner
 231 |           ${isFocused ? 'border-violet-500/50' : 'border-white/5'}
 232 |         `}>
 233 |                     <button className="p-2 rounded-full text-zinc-500 hover:text-zinc-300 hover:bg-white/5 transition-colors">
 234 |                         <Paperclip size={18} />
 235 |                     </button>
 236 | 
 237 |                     <textarea
 238 |                         value={input}
 239 |                         onChange={(e) => setInput(e.target.value)}
 240 |                         onKeyDown={handleKeyDown}
 241 |                         placeholder="Ask AI to edit panels..."
 242 |                         rows={1}
 243 |                         className="flex-1 bg-transparent text-sm text-white placeholder-zinc-500 resize-none max-h-32 py-2 focus:outline-none"
 244 |                         style={{ minHeight: '24px' }}
 245 |                     />
 246 | 
 247 |                     <button
 248 |                         onClick={handleSend}
 249 |                         disabled={!input.trim() || isTyping}
 250 |                         className="p-2 rounded-full bg-violet-500 text-white hover:bg-violet-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-lg shadow-violet-500/20"
 251 |                     >
 252 |                         {isTyping ? <Loader2 size={18} className="animate-spin" /> : <Send size={18} />}
 253 |                     </button>
 254 |                 </div>
 255 |                 <div className="flex justify-between items-center mt-2 px-1">
 256 |                     <p className="text-[10px] text-zinc-600">Model: GPT-4o (Connected via MCP)</p>
 257 |                     <button className="text-zinc-600 hover:text-zinc-400">
 258 |                         <Settings size={12} />
 259 |                     </button>
 260 |                 </div>
 261 |             </div>
 262 |         </div>
 263 |     );
 264 | }
 265 | 
 266 | // --- Definition ---
 267 | 
 268 | const ChatPanel = createPanelDefinition({
 269 |     id: 'chat',
 270 |     name: 'AI Assistant',
 271 |     description: 'Built-in MCP Orchestrator and Chat',
 272 |     icon: MessageSquare,
 273 |     category: PanelCategories.AI,
 274 |     accentColor: 'violet',
 275 | 
 276 |     renderMainView: (props) => <ChatMainView {...props} />,
 277 | 
 278 |     getInitialState: () => ({
 279 |         messages: [
 280 |             {
 281 |                 id: 'welcome',
 282 |                 role: 'assistant',
 283 |                 content: 'Hello! I am connected to your workspace. I can read your panels and execute actions.',
 284 |                 timestamp: Date.now()
 285 |             }
 286 |         ],
 287 |     }),
 288 | 
 289 |     // The Chat Panel itself exposes tools too!
 290 |     getMCPTools: async () => [
 291 |         {
 292 |             name: 'clear_chat',
 293 |             description: 'Clears the chat history',
 294 |             inputSchema: { type: 'object', properties: {} }
 295 |         }
 296 |     ],
 297 | 
 298 |     executeMCPTool: async (name, args, panelState, updateState) => {
 299 |         if (name === 'clear_chat') {
 300 |             updateState({ messages: [] });
 301 |             return { success: true, message: 'Chat cleared' };
 302 |         }
 303 |         throw new Error(`Unknown tool: ${name}`);
 304 |     },
 305 | 
 306 |     actions: [
 307 |         { id: 'chat.clear', label: 'Clear Chat', category: 'Chat', handler: () => { } }, // Handler would be bound at runtime technically or handled globally
 308 |     ],
 309 | });
 310 | 
 311 | export default ChatPanel;

```

`Nexus/src/panels/WorkspacePanel/index.jsx`:

```jsx
   1 | 
   2 | import React, { useState, useCallback } from 'react';
   3 | import {
   4 |     Folder,
   5 |     File,
   6 |     FileText,
   7 |     Image as ImageIcon,
   8 |     Upload,
   9 |     Trash2,
  10 |     Search,
  11 |     Grid,
  12 |     List,
  13 |     Download,
  14 |     Eye
  15 | } from 'lucide-react';
  16 | import { createPanelDefinition, PanelCategories, ContentTypes } from '../BasePanelInterface';
  17 | 
  18 | /**
  19 |  * Workspace Panel - File Browser & Asset Manager
  20 |  * 
  21 |  * Capabilities:
  22 |  * - Upload/Manage files (PDF, MD, Images)
  23 |  * - Expose files to LLM via MCP
  24 |  */
  25 | 
  26 | // --- Components ---
  27 | 
  28 | function FileIcon({ type, size = 20 }) {
  29 |     if (type.startsWith('image/')) return <ImageIcon size={size} className="text-purple-400" />;
  30 |     if (type === 'application/pdf') return <FileText size={size} className="text-red-400" />;
  31 |     if (type === 'text/markdown') return <FileText size={size} className="text-blue-400" />;
  32 |     return <File size={size} className="text-zinc-400" />;
  33 | }
  34 | 
  35 | function FileCard({ file, viewMode, onDelete, onPreview }) {
  36 |     if (viewMode === 'list') {
  37 |         return (
  38 |             <div className="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 group border border-transparent hover:border-white/5 transition-all">
  39 |                 <div className="p-2 rounded bg-zinc-800/50">
  40 |                     <FileIcon type={file.type} size={16} />
  41 |                 </div>
  42 |                 <div className="flex-1 min-w-0">
  43 |                     <h4 className="text-sm text-zinc-200 truncate">{file.name}</h4>
  44 |                     <p className="text-xs text-zinc-500">{(file.size / 1024).toFixed(1)} KB • {new Date(file.lastModified).toLocaleDateString()}</p>
  45 |                 </div>
  46 |                 <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
  47 |                     <button onClick={() => onPreview(file)} className="p-1.5 rounded hover:bg-white/10 text-zinc-400 hover:text-white">
  48 |                         <Eye size={14} />
  49 |                     </button>
  50 |                     <button onClick={() => onDelete(file.id)} className="p-1.5 rounded hover:bg-red-500/10 text-zinc-400 hover:text-red-400">
  51 |                         <Trash2 size={14} />
  52 |                     </button>
  53 |                 </div>
  54 |             </div>
  55 |         );
  56 |     }
  57 | 
  58 |     return (
  59 |         <div className="group relative p-3 rounded-xl bg-zinc-800/30 border border-white/5 hover:border-white/10 hover:bg-zinc-800/50 transition-all">
  60 |             <div className="aspect-square rounded-lg bg-black/20 mb-3 flex items-center justify-center overflow-hidden">
  61 |                 {file.type.startsWith('image/') ? (
  62 |                     <img src={file.url || file.preview} alt={file.name} className="w-full h-full object-cover" />
  63 |                 ) : (
  64 |                     <FileIcon type={file.type} size={32} />
  65 |                 )}
  66 |             </div>
  67 |             <h4 className="text-sm text-zinc-200 truncate font-medium">{file.name}</h4>
  68 |             <p className="text-xs text-zinc-500 mt-1">{(file.size / 1024).toFixed(1)} KB</p>
  69 | 
  70 |             <div className="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
  71 |                 <button onClick={() => onDelete(file.id)} className="p-1.5 rounded-full bg-black/50 text-white hover:bg-red-500 hover:text-white backdrop-blur-sm">
  72 |                     <Trash2 size={12} />
  73 |                 </button>
  74 |             </div>
  75 |         </div>
  76 |     );
  77 | }
  78 | 
  79 | // --- Main View ---
  80 | 
  81 | function WorkspaceMainView({ panelState, updateState }) {
  82 |     const [files, setFiles] = useState(panelState?.files || []);
  83 |     const [viewMode, setViewMode] = useState('grid');
  84 |     const [searchQuery, setSearchQuery] = useState('');
  85 |     const [isDragging, setIsDragging] = useState(false);
  86 | 
  87 |     // Filter files
  88 |     const filteredFiles = files.filter(f => f.name.toLowerCase().includes(searchQuery.toLowerCase()));
  89 | 
  90 |     // Handlers
  91 |     const handleDrop = useCallback((e) => {
  92 |         e.preventDefault();
  93 |         setIsDragging(false);
  94 | 
  95 |         const droppedFiles = Array.from(e.dataTransfer.files).map(f => ({
  96 |             id: `file-${Date.now()}-${Math.random()}`,
  97 |             name: f.name,
  98 |             type: f.type || 'application/octet-stream',
  99 |             size: f.size,
 100 |             lastModified: f.lastModified,
 101 |             // In a real app, we'd upload this. For now, we mock it locally.
 102 |             // We can create an object URL for images to preview.
 103 |             preview: f.type.startsWith('image/') ? URL.createObjectURL(f) : null,
 104 |             content: f.type === 'text/markdown' ? '# Mock Content\n\nThis is a simulated file.' : null // Simplified
 105 |         }));
 106 | 
 107 |         const updated = [...files, ...droppedFiles];
 108 |         setFiles(updated);
 109 |         updateState?.({ files: updated });
 110 |     }, [files, updateState]);
 111 | 
 112 |     const handleDelete = (id) => {
 113 |         const updated = files.filter(f => f.id !== id);
 114 |         setFiles(updated);
 115 |         updateState?.({ files: updated });
 116 |     };
 117 | 
 118 |     return (
 119 |         <div
 120 |             className="flex flex-col h-full bg-zinc-900/30"
 121 |             onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
 122 |             onDragLeave={() => setIsDragging(false)}
 123 |             onDrop={handleDrop}
 124 |         >
 125 |             {/* Toolbar */}
 126 |             <div className="p-4 border-b border-white/5 flex items-center gap-3">
 127 |                 <div className="flex-1 relative">
 128 |                     <Search size={14} className="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500" />
 129 |                     <input
 130 |                         type="text"
 131 |                         placeholder="Search files..."
 132 |                         value={searchQuery}
 133 |                         onChange={e => setSearchQuery(e.target.value)}
 134 |                         className="w-full bg-zinc-800/50 border border-white/5 rounded-lg pl-9 pr-3 py-1.5 text-sm text-white placeholder-zinc-500 focus:border-violet-500/50 focus:outline-none transition-colors"
 135 |                     />
 136 |                 </div>
 137 |                 <div className="flex items-center gap-1 bg-zinc-800/50 rounded-lg p-0.5 border border-white/5">
 138 |                     <button
 139 |                         onClick={() => setViewMode('grid')}
 140 |                         className={`p-1.5 rounded ${viewMode === 'grid' ? 'bg-white/10 text-white' : 'text-zinc-500 hover:text-zinc-300'}`}
 141 |                     >
 142 |                         <Grid size={14} />
 143 |                     </button>
 144 |                     <button
 145 |                         onClick={() => setViewMode('list')}
 146 |                         className={`p-1.5 rounded ${viewMode === 'list' ? 'bg-white/10 text-white' : 'text-zinc-500 hover:text-zinc-300'}`}
 147 |                     >
 148 |                         <List size={14} />
 149 |                     </button>
 150 |                 </div>
 151 |                 <button className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-violet-500 text-white hover:bg-violet-400 transition-colors text-sm font-medium">
 152 |                     <Upload size={14} />
 153 |                     <span className="hidden sm:inline">Upload</span>
 154 |                 </button>
 155 |             </div>
 156 | 
 157 |             {/* Drop overlay */}
 158 |             {isDragging && (
 159 |                 <div className="absolute inset-0 z-50 bg-violet-500/10 backdrop-blur-sm border-2 border-violet-500 border-dashed m-2 rounded-xl flex items-center justify-center pointer-events-none">
 160 |                     <div className="text-violet-200 font-medium flex flex-col items-center gap-3">
 161 |                         <Upload size={48} />
 162 |                         <p>Drop files to upload</p>
 163 |                     </div>
 164 |                 </div>
 165 |             )}
 166 | 
 167 |             {/* Content */}
 168 |             <div className="flex-1 overflow-y-auto p-4">
 169 |                 {filteredFiles.length === 0 ? (
 170 |                     <div className="h-full flex flex-col items-center justify-center text-zinc-500">
 171 |                         <Folder size={48} className="mb-4 opacity-20" />
 172 |                         <p className="text-sm">No files yet</p>
 173 |                         <p className="text-xs mt-1">Drag & drop to upload</p>
 174 |                     </div>
 175 |                 ) : (
 176 |                     <div className={viewMode === 'grid' ? 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4' : 'space-y-1'}>
 177 |                         {filteredFiles.map(file => (
 178 |                             <FileCard key={file.id} file={file} viewMode={viewMode} onDelete={handleDelete} onPreview={() => { }} />
 179 |                         ))}
 180 |                     </div>
 181 |                 )}
 182 |             </div>
 183 |         </div>
 184 |     );
 185 | }
 186 | 
 187 | // --- Definition ---
 188 | 
 189 | const WorkspacePanel = createPanelDefinition({
 190 |     id: 'workspace',
 191 |     name: 'Workspace',
 192 |     description: 'Manage project files and assets',
 193 |     icon: Folder,
 194 |     category: PanelCategories.DATA,
 195 |     accentColor: 'orange',
 196 | 
 197 |     renderMainView: (props) => <WorkspaceMainView {...props} />,
 198 | 
 199 |     getInitialState: () => ({
 200 |         files: [
 201 |             { id: 'f1', name: 'requirements.md', type: 'text/markdown', size: 1024, lastModified: Date.now(), content: '# Project Requirements\n\n1. Built-in Chat\n2. MCP Integration' },
 202 |             { id: 'f2', name: 'architecture.pdf', type: 'application/pdf', size: 2048000, lastModified: Date.now() - 100000, content: null },
 203 |         ],
 204 |     }),
 205 | 
 206 |     getMCPTools: async () => [
 207 |         {
 208 |             name: 'list_files',
 209 |             description: 'List all files in the workspace',
 210 |             inputSchema: { type: 'object', properties: {} }
 211 |         },
 212 |         {
 213 |             name: 'read_file',
 214 |             description: 'Read the content of a specific file',
 215 |             inputSchema: {
 216 |                 type: 'object',
 217 |                 properties: {
 218 |                     filename: { type: 'string', description: 'Name of the file to read' }
 219 |                 },
 220 |                 required: ['filename']
 221 |             }
 222 |         }
 223 |     ],
 224 | 
 225 |     executeMCPTool: async (name, args, panelState) => {
 226 |         const files = panelState?.files || [];
 227 | 
 228 |         if (name === 'list_files') {
 229 |             return {
 230 |                 success: true,
 231 |                 files: files.map(f => ({ name: f.name, type: f.type, size: f.size }))
 232 |             };
 233 |         }
 234 | 
 235 |         if (name === 'read_file') {
 236 |             const file = files.find(f => f.name === args.filename);
 237 |             if (!file) throw new Error(`File not found: ${args.filename}`);
 238 | 
 239 |             if (file.content) return { success: true, content: file.content };
 240 |             return { success: true, content: `[Binary content of ${file.name}, size: ${file.size} bytes]` };
 241 |         }
 242 | 
 243 |         throw new Error(`Unknown tool: ${name}`);
 244 |     },
 245 | 
 246 |     dropZone: {
 247 |         acceptTypes: [ContentTypes.TEXT_MARKDOWN, ContentTypes.IMAGE_PNG, ContentTypes.JSON],
 248 |         onDrop: (data, panelState, updateState) => {
 249 |             // Add drop logic similar to the main view drop handler if needed
 250 |             // For now, the main view handles native file drops
 251 |         }
 252 |     }
 253 | });
 254 | 
 255 | export default WorkspacePanel;

```

`Nexus/src/panels/registry.js`:

```js
   1 | /**
   2 |  * Panel Registry - Central registry for all panel types
   3 |  * 
   4 |  * This allows dynamic registration of panel types,
   5 |  * making the IDE extensible without modifying core code.
   6 |  */
   7 | 
   8 | import DummyCanvasPanel from './DummyCanvasPanel';
   9 | import ChatPanel from './ChatPanel';
  10 | import DummyNotesPanel from './DummyNotesPanel';
  11 | import DummyKanbanPanel from './DummyKanbanPanel';
  12 | import FlowchartPanel from './FlowchartPanel';
  13 | import DummyCodePanel from './DummyCodePanel';
  14 | import WorkspacePanel from './WorkspacePanel';
  15 | 
  16 | // Internal registry map
  17 | const panelRegistry = new Map();
  18 | 
  19 | /**
  20 |  * Register a panel type
  21 |  * @param {IStudioPanelDefinition} panelDefinition 
  22 |  */
  23 | export function registerPanel(panelDefinition) {
  24 |   if (panelRegistry.has(panelDefinition.id)) {
  25 |     console.warn(`Panel type "${panelDefinition.id}" is already registered. Overwriting.`);
  26 |   }
  27 |   panelRegistry.set(panelDefinition.id, panelDefinition);
  28 | }
  29 | 
  30 | /**
  31 |  * Get a panel definition by ID
  32 |  * @param {string} panelTypeId 
  33 |  * @returns {IStudioPanelDefinition | undefined}
  34 |  */
  35 | export function getPanelDefinition(panelTypeId) {
  36 |   return panelRegistry.get(panelTypeId);
  37 | }
  38 | 
  39 | /**
  40 |  * Get all registered panel types
  41 |  * @returns {IStudioPanelDefinition[]}
  42 |  */
  43 | export function getAllPanelDefinitions() {
  44 |   return Array.from(panelRegistry.values());
  45 | }
  46 | 
  47 | /**
  48 |  * Get panel types by category
  49 |  * @param {string} category 
  50 |  * @returns {IStudioPanelDefinition[]}
  51 |  */
  52 | export function getPanelsByCategory(category) {
  53 |   return getAllPanelDefinitions().filter(p => p.category === category);
  54 | }
  55 | 
  56 | /**
  57 |  * Check if a panel type is registered
  58 |  * @param {string} panelTypeId 
  59 |  * @returns {boolean}
  60 |  */
  61 | export function isPanelRegistered(panelTypeId) {
  62 |   return panelRegistry.has(panelTypeId);
  63 | }
  64 | 
  65 | /**
  66 |  * Unregister a panel type
  67 |  * @param {string} panelTypeId 
  68 |  */
  69 | export function unregisterPanel(panelTypeId) {
  70 |   panelRegistry.delete(panelTypeId);
  71 | }
  72 | 
  73 | /**
  74 |  * Get categories with their panels
  75 |  * @returns {Object<string, IStudioPanelDefinition[]>}
  76 |  */
  77 | export function getPanelsByCategories() {
  78 |   const categories = {};
  79 | 
  80 |   for (const panel of panelRegistry.values()) {
  81 |     if (!categories[panel.category]) {
  82 |       categories[panel.category] = [];
  83 |     }
  84 |     categories[panel.category].push(panel);
  85 |   }
  86 | 
  87 |   return categories;
  88 | }
  89 | 
  90 | // === Initialize with built-in panels ===
  91 | export function initializeBuiltInPanels() {
  92 |   registerPanel(DummyCanvasPanel);
  93 |   registerPanel(ChatPanel);
  94 |   registerPanel(DummyNotesPanel);
  95 |   registerPanel(DummyKanbanPanel);
  96 |   registerPanel(FlowchartPanel);
  97 |   registerPanel(DummyCodePanel);
  98 |   registerPanel(WorkspacePanel);
  99 | }
 100 | 
 101 | // Initialize on module load
 102 | initializeBuiltInPanels();
 103 | 
 104 | export default {
 105 |   registerPanel,
 106 |   getPanelDefinition,
 107 |   getAllPanelDefinitions,
 108 |   getPanelsByCategory,
 109 |   isPanelRegistered,
 110 |   unregisterPanel,
 111 |   getPanelsByCategories,
 112 | };

```